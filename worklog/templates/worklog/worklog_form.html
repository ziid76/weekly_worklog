{% extends 'base.html' %}

{% block title %}
    {% if object %}{{ object.month_week_display }} ì£¼ê°„ì—…ë¬´ ìˆ˜ì •{% else %}ìƒˆ ì£¼ê°„ì—…ë¬´ ì‘ì„±{% endif %}
{% endblock %}

{% block content %}
<!-- í˜ì´ì§€ í—¤ë” -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="page-title">
                <i class="fas fa-calendar-week me-3"></i>
                {% if object %}
                    {{ object.month_week_display }} ì£¼ê°„ì—…ë¬´ ìˆ˜ì •
                {% else %}
                    {{title}} ì£¼ê°„ì—…ë¬´ ì‘ì„± ({{start_date}}~{{end_date}})
                {% endif %}
            </h1>
            <p class="page-subtitle mb-0">
                {% if object %}
                    ê¸°ì¡´ ì£¼ê°„ì—…ë¬´ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”
                {% else %}
                    ì£¼ê°„ ì—…ë¬´ ë‚´ìš©ì„ ê¸°ë¡í•˜ì„¸ìš”
                {% endif %}
            </p>
        </div>
        <div class="page-actions">
            <a href="{% url 'worklog_list' %}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i>ëª©ë¡ìœ¼ë¡œ
            </a>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-edit me-2"></i>ì£¼ê°„ì—…ë¬´ ì •ë³´
                </h5>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <!-- ìµœê·¼ ì›Œí¬ë¡œê·¸ ë³µì‚¬ ê¸°ëŠ¥ -->
                    {% if not object %}
                    <div class="mb-4">
                        <div class="card bg-light">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-copy me-2"></i>ìµœê·¼ ì£¼ê°„ì—…ë¬´ ë³µì‚¬
                                </h6>
                            </div>
                            <div class="card-body">
                                <p class="text-muted mb-3">
                                    ìµœê·¼ ì‘ì„±í•œ ì£¼ê°„ì—…ë¬´ì˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                </p>
                                <div class="row">
                                    {% for recent_worklog in recent_worklogs|slice:":3" %}
                                    <div class="col-md-4 mb-2">
                                        <div class="recent-worklog-item card h-100" style="cursor: pointer;" 
                                             onclick="copyWorklog({{ recent_worklog.id }}, '{{ recent_worklog.month_week_display }}')">
                                            <div class="card-body p-3">
                                                <h6 class="card-title mb-1">{{ recent_worklog.month_week_display }}</h6>
                                                {% if recent_worklog.this_week_work %}
                                                <p class="card-text small mt-2 mb-0">
                                                    {{ recent_worklog.this_week_work|striptags|truncatewords:20 }}
                                                </p>
                                                {% endif %}
                                                <div class="text-center mt-2">
                                                    <small class="text-primary">
                                                        <i class="fas fa-copy me-1"></i>í´ë¦­í•˜ì—¬ ë³µì‚¬
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    
                    

                    
                    <!-- ì´ë²ˆ ì£¼ ë‚´ìš© -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="{{ form.this_week_work.id_for_label }}" class="form-label">
                                <i class="fas fa-tasks me-1"></i>ê¸ˆì£¼ ì‹¤ì 
                            </label>
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="showTaskSelector('this_week')">
                                <i class="fas fa-plus me-1"></i>ì—…ë¬´ ì¶”ê°€
                            </button>
                        </div>
                        {{ form.this_week_work }}
                        {% if form.this_week_work.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.this_week_work.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            <i class="fas fa-lightbulb me-1"></i>
                            ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ì¸¡ "ì—…ë¬´ ì¶”ê°€" ë²„íŠ¼ìœ¼ë¡œ Taskë¥¼ ì„ íƒí•˜ì—¬ ìë™ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                    
                    
                    
                    <!-- ë‹¤ìŒ ì£¼ ë‚´ìš© -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="{{ form.next_week_plan.id_for_label }}" class="form-label">
                                <i class="fas fa-calendar-plus me-1"></i>ì°¨ì£¼ ê³„íš
                            </label>
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="showTaskSelector('next_week')">
                                <i class="fas fa-plus me-1"></i>ì—…ë¬´ ì¶”ê°€
                            </button>
                        </div>
                        {{ form.next_week_plan }}
                        {% if form.next_week_plan.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.next_week_plan.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            <i class="fas fa-lightbulb me-1"></i>
                            ë‹¤ìŒ ì£¼ì— ìˆ˜í–‰í•  ì—…ë¬´ë‚˜ ëª©í‘œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
                        </div>
                    </div>
                    
                    <!-- ë²„íŠ¼ ê·¸ë£¹ -->
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            {% if object %}ìˆ˜ì •í•˜ê¸°{% else %}ì €ì¥í•˜ê¸°{% endif %}
                        </button>
                        <a href="{% url 'worklog_list' %}" class="btn btn-outline-primary">
                            <i class="fas fa-times me-2"></i>ì·¨ì†Œ
                        </a>
                        {% if object %}
                        <a href="{% url 'worklog_detail' object.pk %}" class="btn btn-outline-primary">
                            <i class="fas fa-eye me-2"></i>ìƒì„¸ë³´ê¸°
                        </a>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- ì‚¬ì´ë“œë°” -->
    <div class="col-lg-4">
        <!-- ë„ì›€ë§ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-question-circle me-2"></i>ì‘ì„± ë„ì›€ë§
                </h5>
            </div>
            <div class="card-body">
                <div class="help-section">
                    <h6><i class="fas fa-markdown me-1"></i>ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•</h6>
                    <ul class="list-unstyled small">
                        <li><code>**êµµì€ ê¸€ì”¨**</code></li>
                        <li><code>- ëª©ë¡ í•­ëª©</code></li>
                        <li><code>1. ë²ˆí˜¸ ëª©ë¡</code></li>

                    </ul>
                </div>
                
                <div class="help-section mt-3">
                    <h6><i class="fas fa-lightbulb me-1"></i>ì‘ì„± íŒ</h6>
                    <ul class="list-unstyled small">
                        <li>â€¢ êµ¬ì²´ì ì¸ ì„±ê³¼ì™€ ê²°ê³¼ ê¸°ë¡</li>
                        <li>â€¢ ë°œìƒí•œ ì´ìŠˆì™€ í•´ê²°ë°©ì•ˆ ëª…ì‹œ</li>
                        <li>â€¢ ë‹¤ìŒ ì£¼ ê³„íšì€ ì‹¤í–‰ ê°€ëŠ¥í•˜ê²Œ</li>
                        <li>â€¢ ì •ëŸ‰ì  ì§€í‘œ í¬í•¨ ê¶Œì¥</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- ìµœê·¼ ì£¼ê°„ì—…ë¬´ -->
        {% if recent_worklogs %}
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-history me-2"></i>ìµœê·¼ ì£¼ê°„ì—…ë¬´
                </h5>
            </div>
            <div class="card-body">
                {% for worklog in recent_worklogs %}
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <a href="{% url 'worklog_detail' worklog.pk %}" class="text-decoration-none">
                            {{ worklog.month_week_display }}
                        </a>
                        <small class="text-muted d-block">{{ worklog.created_at|date:"m/d" }}</small>
                    </div>
                    <a href="{% url 'worklog_update' worklog.pk %}" class="btn btn-sm btn-outline-secondary">
                        <i class="fas fa-edit"></i>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}


<style>
.help-section {
    padding: 12px 0;
    border-bottom: 1px solid var(--naver-gray-200);
}

.help-section:last-child {
    border-bottom: none;
}

.help-section h6 {
    color: var(--naver-gray-700);
    font-size: 14px;
    margin-bottom: 8px;
}

.help-section ul li {
    margin-bottom: 4px;
    color: var(--naver-gray-600);
}

.help-section code {
    background-color: var(--naver-gray-100);
    padding: 2px 4px;
    border-radius: 3px;
    font-size: 12px;
}

textarea {
    min-height: 120px;
    resize: vertical;
}

.form-text {
    font-size: 13px;
    color: var(--naver-gray-500);
    margin-top: 6px;
}

/* ìµœê·¼ ì›Œí¬ë¡œê·¸ ë³µì‚¬ ìŠ¤íƒ€ì¼ */
.recent-worklog-item {
    transition: all 0.3s ease;
    border: 1px solid #e9ecef;
}

.recent-worklog-item:hover {
    border-color: #03C75A;
    box-shadow: 0 4px 12px rgba(3, 199, 90, 0.15);
    transform: translateY(-2px);
}

.recent-worklog-item .card-title {
    color: #03C75A;
    font-weight: 600;
}

/* Task ì„ íƒ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.task-selector-list {
    max-height: 400px;
    overflow-y: auto;
}

.task-selector-item {
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
}

.task-selector-item:hover {
    border-color: #03C75A;
    box-shadow: 0 2px 8px rgba(3, 199, 90, 0.1);
    transform: translateY(-1px);
}

.task-selector-item .btn {
    opacity: 0.7;
    transition: opacity 0.3s ease;
}

.task-selector-item:hover .btn {
    opacity: 1;
}

/* Task ê´€ë ¨ ìŠ¤íƒ€ì¼ */
.task-item {
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
}

.task-item:hover {
    border-color: #03C75A;
    box-shadow: 0 2px 8px rgba(3, 199, 90, 0.1);
}

.task-meta span {
    display: inline-block;
}

.task-actions .btn {
    width: 32px;
    height: 32px;
    padding: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.worklog-task-status .badge {
    font-size: 11px;
}

.bg-urgent-priority { background-color: #dc3545 !important; }
.bg-high-priority { background-color: #fd7e14 !important; }
.bg-medium-priority { background-color: #0dcaf0 !important; }
.bg-low-priority { background-color: #198754 !important; }
</style>

<!-- Task ì„ íƒ ëª¨ë‹¬ (í…ìŠ¤íŠ¸ ì¶”ê°€ìš©) -->
<div class="modal fade" id="taskSelectorModal" tabindex="-1" aria-labelledby="taskSelectorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="taskSelectorModalLabel">
                    <i class="fas fa-clipboard-list me-2"></i>ì—…ë¬´ ì„ íƒ
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <input type="text" class="form-control" id="taskSearchInput" placeholder="ì—…ë¬´ ì œëª©ìœ¼ë¡œ ê²€ìƒ‰...">
                </div>
                <div id="taskList" class="task-selector-list">
                    <!-- ì—…ë¬´ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>
</div>

<!-- Task ì—°ê²° ëª¨ë‹¬ (ê¸°ì¡´) -->
{% if object %}
<div class="modal fade" id="addTaskModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addTaskModalLabel">
                    <i class="fas fa-plus me-2"></i>ì—…ë¬´ ì—°ê²°
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{% url 'add_task_to_worklog' object.id %}">
                <div class="modal-body">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ task_form.task.id_for_label }}" class="form-label">ì—…ë¬´ ì„ íƒ</label>
                            {{ task_form.task }}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ task_form.status.id_for_label }}" class="form-label">ìƒíƒœ</label>
                            {{ task_form.status }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ task_form.progress.id_for_label }}" class="form-label">ì§„í–‰ë¥  (%)</label>
                            {{ task_form.progress }}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ task_form.time_spent.id_for_label }}" class="form-label">ì†Œìš” ì‹œê°„ (ì‹œê°„)</label>
                            {{ task_form.time_spent }}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="{{ task_form.notes.id_for_label }}" class="form-label">ë¹„ê³ </label>
                        {{ task_form.notes }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus me-1"></i>ì—°ê²°
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}

<script>
// ì›Œí¬ë¡œê·¸ ë³µì‚¬ ê¸°ëŠ¥
function copyWorklog(worklogId, weekDisplay) {
    if (confirm(`"${weekDisplay}" ì›Œí¬ë¡œê·¸ì˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní˜„ì¬ ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì€ ë®ì–´ì“°ì—¬ì§‘ë‹ˆë‹¤.`)) {
        fetch(`/worklog/api/copy/${worklogId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // í…ìŠ¤íŠ¸ ì˜ì—­ì— ë‚´ìš© ë³µì‚¬
                    const thisWeekTextarea = document.getElementById('{{ form.this_week_work.id_for_label }}');
                    const nextWeekTextarea = document.getElementById('{{ form.next_week_plan.id_for_label }}');
                    
                    if (data.this_week_work && thisWeekTextarea) {
                        thisWeekTextarea.value = data.this_week_work;
                        // í…ìŠ¤íŠ¸ ì˜ì—­ í¬ê¸° ìë™ ì¡°ì •
                        thisWeekTextarea.style.height = 'auto';
                        thisWeekTextarea.style.height = (thisWeekTextarea.scrollHeight) + 'px';
                    }
                    
                    if (data.next_week_plan && nextWeekTextarea) {
                        nextWeekTextarea.value = data.next_week_plan;
                        // í…ìŠ¤íŠ¸ ì˜ì—­ í¬ê¸° ìë™ ì¡°ì •
                        nextWeekTextarea.style.height = 'auto';
                        nextWeekTextarea.style.height = (nextWeekTextarea.scrollHeight) + 'px';
                    }
                    
                    showToast(`"${weekDisplay}" ì›Œí¬ë¡œê·¸ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                } else {
                    showToast('ì›Œí¬ë¡œê·¸ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            })
            .catch(error => {
                console.error('Error copying worklog:', error);
                showToast('ì›Œí¬ë¡œê·¸ ë³µì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            });
    }
}

let currentTargetField = '';

// Task ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
function showTaskSelector(targetField) {
    currentTargetField = targetField;
    const modal = new bootstrap.Modal(document.getElementById('taskSelectorModal'));
    modal.show();
    loadUserTasks();
}

// ì‚¬ìš©ì ì—…ë¬´ ëª©ë¡ ë¡œë“œ
function loadUserTasks(search = '') {
    fetch(`{% url 'get_user_tasks_api' %}?search=${encodeURIComponent(search)}`)
        .then(response => response.json())
        .then(data => {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            if (data.tasks && data.tasks.length > 0) {
                data.tasks.forEach(task => {
                    const taskItem = createTaskItem(task);
                    taskList.appendChild(taskItem);
                });
            } else {
                taskList.innerHTML = '<div class="text-center text-muted py-4">ê²€ìƒ‰ëœ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        })
        .catch(error => {
            console.error('Error loading tasks:', error);
            document.getElementById('taskList').innerHTML = '<div class="text-center text-danger py-4">ì—…ë¬´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        });
}

// Task ì•„ì´í…œ ìƒì„±
function createTaskItem(task) {
    const div = document.createElement('div');
    div.className = 'task-selector-item card mb-2';
    div.style.cursor = 'pointer';
    
    const priorityColors = {
        'ê¸´ê¸‰': 'danger',
        'ë†’ìŒ': 'warning', 
        'ë³´í†µ': 'info',
        'ë‚®ìŒ': 'success'
    };
    
    div.innerHTML = `
        <div class="card-body p-3">
            <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                    <h6 class="mb-1">
                        <span class="badge bg-${priorityColors[task.priority] || 'secondary'} me-2">
                            ${task.priority}
                        </span>
                        ${task.title}
                    </h6>
                    <div class="task-meta text-muted small">
                        <span class="me-3">
                            <i class="fas fa-flag me-1"></i>
                            ${task.status}
                        </span>
                        ${task.category ? `<span class="me-3"><i class="fas fa-tag me-1"></i>${task.category}</span>` : ''}
                        ${task.due_date ? `<span class="me-3"><i class="fas fa-calendar me-1"></i>${task.due_date}</span>` : ''}
                    </div>
                </div>
                <button type="button" class="btn btn-primary btn-sm" onclick="addTaskToText(${task.id}, '${task.title}', '${task.status}', '${task.priority}')">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
    `;
    
    return div;
}

// Taskë¥¼ í…ìŠ¤íŠ¸ ì˜ì—­ì— ì¶”ê°€
function addTaskToText(taskId, title, status, priority) {
    const targetTextarea = currentTargetField === 'this_week' 
        ? document.getElementById('{{ form.this_week_work.id_for_label }}')
        : document.getElementById('{{ form.next_week_plan.id_for_label }}');
    
    if (!targetTextarea) return;
    
    // ìƒíƒœì— ë”°ë¥¸ ì•„ì´ì½˜ ì„ íƒ
    const statusIcon = status === 'ì™„ë£Œ' ? 'âœ…' : status === 'ì§„í–‰ì¤‘' ? 'ğŸ”„' : 'ğŸ“‹';
    const priorityText = priority !== 'ë³´í†µ' ? ` [${priority}]` : '';
    
    // ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì—…ë¬´ ì •ë³´ ìƒì„±
    const taskMarkdown = `- ${statusIcon} **${title}**${priorityText}\n`;
    
    // í˜„ì¬ ì»¤ì„œ ìœ„ì¹˜ì— í…ìŠ¤íŠ¸ ì‚½ì…
    const cursorPos = targetTextarea.selectionStart;
    const textBefore = targetTextarea.value.substring(0, cursorPos);
    const textAfter = targetTextarea.value.substring(targetTextarea.selectionEnd);
    
    targetTextarea.value = textBefore + taskMarkdown + textAfter;
    
    // ì»¤ì„œ ìœ„ì¹˜ ì¡°ì •
    const newCursorPos = cursorPos + taskMarkdown.length;
    targetTextarea.setSelectionRange(newCursorPos, newCursorPos);
    targetTextarea.focus();
    
    // í…ìŠ¤íŠ¸ ì˜ì—­ í¬ê¸° ìë™ ì¡°ì •
    targetTextarea.style.height = 'auto';
    targetTextarea.style.height = (targetTextarea.scrollHeight) + 'px';
    
    // ëª¨ë‹¬ ë‹«ê¸°
    const modal = bootstrap.Modal.getInstance(document.getElementById('taskSelectorModal'));
    modal.hide();
    
    // ì„±ê³µ ë©”ì‹œì§€
    showToast(`ì—…ë¬´ "${title}"ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
}

// í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
function showToast(message, type = 'info') {
    // ê°„ë‹¨í•œ í† ìŠ¤íŠ¸ êµ¬í˜„
    const toast = document.createElement('div');
    toast.className = `alert alert-${type} position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.innerHTML = `
        ${message}
        <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 3000);
}

// ê²€ìƒ‰ ê¸°ëŠ¥
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('taskSearchInput');
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                loadUserTasks(this.value);
            }, 300);
        });
    }
});

// Task ìˆ˜ì • ê¸°ëŠ¥
function editWorklogTask(worklogTaskId) {
    // ê°„ë‹¨í•œ êµ¬í˜„ - ì‹¤ì œë¡œëŠ” ëª¨ë‹¬ì„ í†µí•´ ìˆ˜ì •
    alert('Task ìˆ˜ì • ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
}

// ì§„í–‰ë¥  ìŠ¬ë¼ì´ë” ì—…ë°ì´íŠ¸
document.addEventListener('DOMContentLoaded', function() {
    const progressInput = document.getElementById('{{ task_form.progress.id_for_label }}');
    if (progressInput) {
        progressInput.addEventListener('input', function() {
            const value = this.value;
            const label = document.querySelector('label[for="{{ task_form.progress.id_for_label }}"]');
            if (label) {
                label.textContent = `ì§„í–‰ë¥  (${value}%)`;
            }
        });
    }
});
</script>
{% endblock %}
