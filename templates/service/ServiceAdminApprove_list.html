{% extends 'basic.html' %}
{% load static %}

{% block page_name %}SR 승인{% endblock %}

{% block content %}
<div class="flex flex-col gap-8">
    <!-- Header Section -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div class="flex flex-col gap-1">
            <h1 class="text-3xl font-extrabold tracking-tight text-slate-900">SR 승인 관리</h1>
            <p class="text-slate-500 font-medium text-sm">대기 중인 SR 요청 및 릴리즈 승인 항목을 관리합니다.</p>
        </div>
    </div>

    <!-- Table Section -->
    <div class="bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden">
        <div class="p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
            <h2 class="text-lg font-bold text-slate-900 flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">pending_actions</span>
                승인 대기 목록
            </h2>
            <span class="px-3 py-1 bg-primary/10 text-primary text-xs font-bold rounded-full">
                총 {{ pending_items|length }}건
            </span>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-slate-50/50">
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-wider border-b border-slate-100">승인 유형</th>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-wider border-b border-slate-100 whitespace-nowrap">SR No / 요청번호</th>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-wider border-b border-slate-100">제목 / 시스템 정보</th>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-wider border-b border-slate-100">요청일자</th>
                        <th class="px-6 py-4 text-right text-[10px] font-bold text-slate-400 uppercase tracking-wider border-b border-slate-100">액션</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                    {% if pending_items %}
                        {% for item in pending_items %}
                        <tr class="hover:bg-slate-50/80 transition-colors group">
                            <td class="px-6 py-4">
                                {% if item.type == 'sr' %}
                                    <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-rose-50 text-rose-600 text-[11px] font-bold border border-rose-100">
                                        <span class="size-1.5 rounded-full bg-rose-500"></span>
                                        요청 승인
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-emerald-50 text-emerald-600 text-[11px] font-bold border border-emerald-100">
                                        <span class="size-1.5 rounded-full bg-emerald-500"></span>
                                        CTS/릴리즈 승인
                                    </span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 min-w-[120px]">
                                <span class="text-sm font-bold text-slate-700">
                                    {% if item.type == 'sr' %}{{ item.sr.id }}{% else %}{{ item.release.request_number }}{% endif %}
                                </span>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex flex-col">
                                    <span class="text-sm font-bold text-slate-900 line-clamp-1">
                                        {% if item.type == 'sr' %}{{ item.sr.req_title }}{% else %}{{ item.release.service_request.req_title }}{% endif %}
                                    </span>
                                    <span class="text-[11px] text-slate-500 font-medium">
                                        {% if item.type == 'sr' %}
                                            {% if item.sr.req_system %}시스템: {{ item.sr.req_system }}{% endif %}
                                            {% if item.sr.req_module %} | 모듈: {{ item.sr.req_module }}{% endif %}
                                        {% else %}
                                            {{ item.release.source_system }} <span class="text-primary mx-1">→</span> {{ item.release.target_system }}
                                        {% endif %}
                                    </span>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="text-xs font-bold text-slate-500">
                                    {% if item.type == 'sr' %}{{ item.sr.date_of_req|default:"-" }}{% else %}{{ item.release.release_date }}{% endif %}
                                </span>
                            </td>
                            <td class="px-6 py-4 text-right whitespace-nowrap">
                                <div class="flex items-center justify-end gap-2 translate-x-4 opacity-0 group-hover:translate-x-0 group-hover:opacity-100 transition-all duration-200">
                                    <a href="{% if item.type == 'sr' %}{% url 'service_request_detail' item.sr.id %}{% else %}{% url 'service_request_detail' item.release.service_request.id %}{% endif %}" 
                                       class="p-2 rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors" title="상세보기">
                                        <span class="material-symbols-outlined text-[20px]">visibility</span>
                                    </a>
                                    
                                    {% if item.type == 'sr' %}
                                    <form method="post" action="{% url 'service_request_approve' item.sr.id %}" class="inline">
                                        {% csrf_token %}
                                        <button type="submit" class="p-2 rounded-lg bg-emerald-100 text-emerald-600 hover:bg-emerald-200 transition-colors"
                                                onclick="return confirm('요청을 승인하시겠습니까?');" title="승인">
                                            <span class="material-symbols-outlined text-[20px]">check_circle</span>
                                        </button>
                                    </form>
                                    {% else %}
                                    <form method="post" action="{% url 'service_request_release_approve' item.release.id %}" class="inline">
                                        {% csrf_token %}
                                        <button type="submit" class="p-2 rounded-lg bg-emerald-100 text-emerald-600 hover:bg-emerald-200 transition-colors"
                                                onclick="return confirm('릴리즈를 승인하시겠습니까?');" title="승인">
                                            <span class="material-symbols-outlined text-[20px]">check_circle</span>
                                        </button>
                                    </form>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="5" class="px-6 py-20 text-center">
                                <div class="flex flex-col items-center gap-3 text-slate-400">
                                    <span class="material-symbols-outlined text-5xl opacity-20">inventory_2</span>
                                    <p class="text-sm font-bold">승인 대기 중인 항목이 없습니다.</p>
                                </div>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

