# 🔗 웹훅 및 인시던트 관리 가이드

외부 모니터링 시스템(와탭 등)의 알림을 ITMS에서 통합 관리하기 위한 웹훅 설정 및 인시던트 처리 가이드입니다.

---

## 1. 개요
웹훅(Webhook) 기능을 사용하면 외부 시스템에서 발생하는 장애나 경고 이벤트를 ITMS로 실시간 전송할 수 있습니다. 수신된 이벤트는 **인시던트(Incident)**로 자동 등록되어 팀 내에서 공유하고 해결 과정을 추적할 수 있습니다.

## 2. 웹훅 설정 단계 (WhaTap 예시)

### 1단계: 웹훅 소스 생성
1. 사이드바에서 **[Monitoring] → [인시던트 관리]** 메뉴로 이동합니다.
2. 우측 상단의 **[웹훅 소스 관리]** 버튼을 클릭합니다.
3. **[새 소스 추가]** 버튼을 클릭합니다.
4. 아래 정보를 입력하고 생성합니다.
   - **소스 이름**: 식별하기 쉬운 이름 (예: `와탭 실운영 환경`)
   - **소스 유형**: `WhaTap (와탭)` 선택
   - **비밀 토큰**: (선택 사항) 보안을 위해 사용할 임의의 문자열

### 2단계: 웹훅 URL 복사
1. 생성된 소스 목록에서 해당 항목의 **Webhook URL** 영역을 확인합니다.
2. `https://.../hooks/whatap/<source_key>/` 형태의 URL을 복사합니다.

### 3단계: 외부 시스템(와탭)에 등록
1. 와탭(WhaTap) 관리 콘솔에 접속합니다.
2. **알림 설정 → 웹훅(Webhook)** 메뉴로 이동합니다.
3. **[추가]** 버튼을 누르고 복사한 URL을 붙여넣습니다.
4. (비밀 토큰을 설정한 경우) 헤더에 `X-Webhook-Token` 키로 토큰값을 추가합니다.
5. 테스트 전송을 통해 ITMS 인시던트 목록에 정상적으로 들어오는지 확인합니다.

---

## 3. 인시던트 관리 프로세스

웹훅을 통해 이벤트가 수신되면 시스템은 아래 과정을 자동으로 처리합니다.

### 인시던트 수신 및 자동 처리
- **중복 방지(Dedupe)**: 동일한 대상(`oid`)과 메트릭에서 발생한 알림은 하나의 인시던트로 통합 관리됩니다.
- **상태 업데이트**: 와탭에서 장애가 해소(`RESOLVED` 또는 `OK`)되면 ITMS 내 인시던트 상태도 자동으로 `Resolved`로 변경됩니다.

### 사용자의 조치 단계
1. **확인 (Acknowledge)**
   - 인시던트 목록에서 새 이벤트를 클릭하여 상세 내용을 확인합니다.
   - 우측 [Status Actions]에서 **[Ack]** 버튼을 눌러 담당자가 확인 중임을 팀원들에게 알립니다.
2. **분석 및 코멘트**
   - 타임라인 하단의 [Add Comment] 영역에 중간 분석 결과나 조치 내용을 기록합니다.
   - 기록된 내용은 타임라인에 시간 순서대로 보관됩니다.
3. **해결 (Resolve) 및 종료 (Close)**
   - 장애 조치가 완료되면 **[Resolve]**를 누릅니다.
   - 모든 후속 조치가 완료된 후 최종적으로 **[Close]** 처리하여 마무리합니다.

---

## 4. 인시던트 타임라인 이해하기
인시던트 상세 페이지의 **Incident Timeline**은 해당 장애의 생애주기를 보여줍니다.

- **Created**: 웹훅을 통해 인시던트가 처음 생성된 시점
- **Webhook Received**: 동일 인시던트에 대해 추가적인 알림이나 상태 변경이 수신된 이력
- **Status Changed**: 사용자가 수동으로 상태를 변경한 기록
- **Commented**: 사용자가 남긴 기술 메모 또는 의견
- **Raw Webhook Payload**: (개발자용) 수신된 실제 JSON 데이터 원본 확인 가능

---

## 5. 자주 묻는 질문 (FAQ)

**Q: 인시던트가 자동으로 생성되지 않습니다.**
- 웹훅 소스가 '활성' 상태인지 확인하세요.
- 전송된 JSON 페이로드에 `title`, `pcode`, `uuid` 등 필수 필드가 포함되어 있는지 확인하세요.

**Q: 알림이 올 때마다 인시던트가 새로 생깁니다.**
- 시스템은 `pcode`, `oid`, `metricName`, `title` 조합으로 지문(Fingerprint)을 생성합니다. 이 정보 중 하나라도 다르면 별개의 인시던트로 취급됩니다.

**Q: 인시던트를 삭제하고 싶습니다.**
- 인시던트는 이력 관리를 위해 삭제 대신 **[Close]** 처리를 권장합니다.

---
**💡 팁**: 인시던트 상세 화면에서 장애 원인과 해결 방법을 코멘트로 잘 남겨두면, 향후 유사한 장애 발생 시 훌륭한 지식 베이스가 됩니다.
